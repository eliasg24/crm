{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CALENDARIO CRM</title>
    
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'fullcalendar/main.min.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="{% static 'css/style.css' %}" rel="stylesheet"/>
    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'fullcalendar/main.min.js' %}"></script>    

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <script src="/bundles/modernizr?v=wBEWDufH_8Md-Pbioxomt90vm6tJN2Pyy9u9zHtWsPo1"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/bundles/bootstrap?v=QtxRrbVxHAK-b5ZowWqv6Wt7oUOJAggG80vl1X-EGBM1"></script>

    <script src="/bundles/timepicker?v=SNA17wI1rMl4CP8ayG1ydmEu0eLQfZiFCqPl0hXZpd01"></script>

    <script src="/bundles/sweet?v=ZMOC4FpxSbszBSzdHGvkc9O_scCReJoQ_PgxKeHWirk1"></script>


</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
        <a class="navbar-brand">Lead</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="navbarSupportedContent" class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Captura prospectos</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{% url 'dashboards:captura' %}">Venta</a>
                        <a class="dropdown-item" href="/Compras/CompraCaptura">Compra</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Operativo Anfitrion</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{% url 'dashboards:operativo_anfitrion' %}">Venta</a>
                        <a class="dropdown-item" href="/Compras/OperativoAnfitrionCompras">Compra</a>
                        <a class="dropdown-item" href="/SolicitudPeritaje/SeguimientoAnfitrion">Solicitudes de Peritaje</a>
                    </div>
                </li>

                    <li><a class="nav-link" href="{% url 'dashboards:operativo_asesor' %}">Operativo Asesor</a></li>

                    <li><a class="nav-link" href="/Compras/OperativoComprador">Operativo Comprador</a></li>
                                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Reportes</a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="{% url 'dashboards:reportes' %}">Venta</a>
                            <a class="dropdown-item" href="/Compras/ReportesCompras">Compra</a>
                            <a class="dropdown-item" href="/SolicitudPeritaje/ReportesSolicitudesPeritaje">Solicitudes Peritaje</a>
                            <a class="dropdown-item" href="{% url 'dashboards:tiempos' %}">Tiempos</a>
                            <a class="dropdown-item" href="{% url 'dashboards:anulados' %}">Anulados</a>
                            <a class="dropdown-item" href="{% url 'dashboards:reportes_eventos' %}">Eventos</a>
                        </div>
                    </li>
                    <li><a class="nav-link" href="{% if calendario_general %}{% url 'dashboards:calendar' %}{% else %}{% url 'dashboards:calendar_detail' asesor_actual.pk %}{% endif %}">Calendario</a></li>
                    <li><a class="nav-link" href="/Compras/OperativoPerito">Operativo Perito</a></li>
                    <li><a class="nav-link" href="/Compras/OperativoTaller">Operativo Taller</a></li>
                                    <li><a class="nav-link" href="http://capnet2.ddns.net:5007/" target="_blank">KPI's</a></li>
            </ul>
            <div class="form-inline">
                <button type="button" style="margin-right: 30px; border: none transparent; background-color:transparent; color:white;" onClick="history.back();"><i class="material-icons">reply</i>Atras</button>
            <form action="{% url 'dashboards:logout' %}" method="post">
                {% csrf_token %}
                <button type="submit" value="CerrarSesion" style="border: none transparent; background-color:transparent; color:white;"><i class="material-icons">exit_to_app</i>Salir</button>
            </form>    
            </div>
            
        </div>
    </nav>
    <div class="container py-5" id="page-container">
        <div class="row">
            <div class="col-md-9">
                <div id="calendar"></div>
            </div>
            <div class="col-md-3">
                {% if mostrar_evento %}
                <div class="cardt rounded-0 shadow">
                    <div class="card-header bg-gradient bg-primary text-light">
                        <h5 class="card-title">Crear Evento</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" id="schedule-form">
                            {% csrf_token %}
                            <div class="container-fluid">
                                <input type="hidden" name="id" value="">
                                <div class="form-group mb-2">
                                    <label for="title" class="control-label">Nombre</label>
                                    <input type="text" class="form-control form-control-sm rounded-0" name="nombre" id="nombre" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="description" class="control-label">Tipo de evento</label>
                                    <select class="form-control" id="tipo" name="tipo"><option selected="selected" value="0">-- Tipo de evento --</option>
                                        <option value="Testdrive">Testdrive</option>
                                        <option value="Peritaje">Peritaje</option>
                                        <option value="Whatsapp">Whatsapp</option>
                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="start_datetime" class="control-label">Cliente</label>
                                    <input type="text" class="form-control form-control-sm rounded-0" name="cliente" id="cliente" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="end_datetime" class="control-label">Observaciones</label>
                                    <textarea rows="3" class="form-control form-control-sm rounded-0" name="observaciones" id="observaciones" required></textarea>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="start_datetime" class="control-label">Asesor</label>
                                    <select class="form-control" id="asesor" name="asesor"><option selected="selected" value="0">-- Asesor --</option>
                                        {% for asesor in asesores %}
                                        <option value="{{asesor.nombre}}">{{asesor.nombre}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="fecha_hora" class="control-label">Fecha y hora</label>
                                    <input type="datetime-local" class="form-control form-control-sm rounded-0" name="fecha_hora" id="fecha_hora" required>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="text-center">
                                <button class="btn btn-primary btn-sm rounded-0" type="submit" form="schedule-form"><i class="fa fa-save"></i> Guardar</button>
                                <button class="btn btn-default border btn-sm rounded-0" type="reset" form="schedule-form"><i class="fa fa-reset"></i> Cancelar</button>
                            </div>
                        </div>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Event Details Modal -->
    <div class="modal fade" tabindex="-1" data-bs-backdrop="static" id="event-details-modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-0">
                <div class="modal-header rounded-0">
                    <h5 class="modal-title">Detalles de evento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body rounded-0">
                    <div class="container-fluid">
                        <dl>
                            <dt class="text-muted">Nombre</dt>
                            <dd id="title" class="fw-bold fs-4"></dd>
                            <dt class="text-muted">Observaciones</dt>
                            <dd id="description" class=""></dd>
                            <dt class="text-muted">Fecha y hora</dt>
                            <dd id="start" class=""></dd>
                        </dl>
                    </div>
                </div>
                <div class="modal-footer rounded-0">
                    <div class="text-end">
                        <button type="button" class="btn btn-primary btn-sm rounded-0" id="modalEvento" data-toggle="modal" data-target="#ModalEvento" onclick="editar_evento()">Editar</button>
                        <button type="button" class="btn btn-danger btn-sm rounded-0" id="delete" data-id="">Eliminar</button>
                        <button type="button" class="btn btn-secondary btn-sm rounded-0" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
                <div class="modal fade bd-example-modal-lg" id="ModalEvento" tabindex="-1" role="dialog" aria-labelledby="exampleModalPreviewLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5>Crear Evento</h5>
                                <button class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body small">
                                <div class="form-row">
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="EventoNombre" class="col-form-label">Nombre:</label>
                                            <input type="text" class="form-control" id="EventoNombre">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="EventoTipo" class="col-form-label">Tipo evento:</label>
                                            <select class="form-control" id="EventoTipo" name="EventoTipo"><option selected="selected" value="0">-- Tipo de evento --</option>
                                                <option value="Testdrive">Testdrive</option>
                                                <option value="Peritaje">Peritaje</option>
                                                <option value="Whatsapp">Whatsapp</option>
                                            </select>
                                        </div>
                                    </div>                   
                                </div>
                                <div class="form-row">
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="EventoCliente" class="col-form-label">Cliente:</label>
                                            <input type="text" class="form-control" id="EventoCliente">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="EventoObservaciones" class="col-form-label">Observaciones:</label>
                                            <input type="text" class="form-control" id="EventoObservaciones">
                                        </div>
                                    </div>         
                                </div>
                                <div class="form-row">
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="EventoAsesor" class="col-form-label">Asesor:</label>
                                            <select class="form-control" id="EventoAsesor" name="EventoAsesor"><option selected="selected" value="0">-- Asesor --</option>
                                                {% for asesor in asesores %}
                                                <option value="{{asesor.nombre}}">{{asesor.nombre}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="mb-4">
                                            <label for="EventoFechaHora" class="col-form-label">Fecha y hora:</label>
                                            <input type="datetime-local" class="form-control" id="EventoFechaHora">
                                        </div>
                                    </div>         
                                    
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="subir_formulario_evento();">Confirmar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <div class="card-body p-4">
        <form>
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="mb-4">
                        <label for="exampleInputPassword1" class="form-label fw-semibold">Eventos hoy</label>
                        <input type="int" class="form-control" id="evento_hoy" style="background-color: white;" placeholder="" readonly value="{% if general %}{{cantidad_hoy}}{% else %}{% for evento in eventos_hoy %}{% if evento.asesor == adviser.pk %}{{evento.cantidad}}{% endif %}{% endfor %}{% endif %}">
                    </div>
                </div>
                <div class="col-lg-3 col-md-3">
                    <div class="mb-4">
                        <label for="exampleInputPassword1" class="form-label fw-semibold">Leads sin eventos</label>
                        <input type="int" class="form-control" id="exampleInputtext" style="background-color: white;" placeholder="" readonly value="0">
                    </div>
                </div>
                <div class="col-lg-3 col-md-3">
                    <div class="mb-4">
                        <label for="exampleInputPassword1" class="form-label fw-semibold">Eventos vencidos</label>
                        <input type="int" class="form-control" id="exampleInputtext" style="background-color: white;" placeholder="" readonly value="0">
                    </div>
                </div>
                <div class="col-lg-3 col-md-3">
                    <div class="mb-4">
                        <label for="exampleInputPassword1" class="form-label fw-semibold">Eventos pendientes</label>
                        <input type="int" class="form-control" id="evento_pendiente" style="background-color: white;" placeholder="" readonly value="{% if general %}{{cantidad_pendientes}}{% else %}{% for evento in eventos_pendientes %}{% if evento.asesor == adviser.pk %}{{evento.cantidad}}{% endif %}{% endfor %}{% endif %}">
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Event Details Modal -->

</body>

<script src="{% static 'js/es.js' %}"></script> <!--Idioma español Fullcalendar-->
<script>

    if ($('#evento_hoy').val() == '') {
        document.getElementById("evento_hoy").value = 0;
    }
    if ($('#evento_pendiente').val() == '') {
        document.getElementById("evento_pendiente").value = 0;
    }
    var scheds = $.parseJSON('{ {% for evento in eventos %}"{{evento.id}}":{"id":"{{evento.id}}","title":"{{evento.nombre}}","description":"{{evento.observaciones}}","start_datetime":"{{evento.fecha_hora|date:"Y-m-d"}} {{evento.fecha_hora|time:"H:i"}}:00","end_datetime":"{{evento.fecha_hora|date:"Y-m-d"}} {{evento.fecha_hora|time:"H:i"}}:00","sdate":"{{evento.fecha_hora|date:"F d, Y"}} {{evento.fecha_hora|time:"H:i A"}}","edate":"{{evento.fecha_hora|date:"F d, Y"}} {{evento.fecha_hora|time:"H:i A"}}"}{% if not forloop.last %},{% endif %}{% endfor %}}')
    
</script>
<script src="{% static 'js/script.js' %}"></script>

</html>