{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captura - Prospectos Madiautos</title>
    <link rel="stylesheet" href="./assets/fonts/googlefonts/fonts.css"/>
    <link rel="stylesheet" href="./css/blokk.0445c8d9103f65489e035d5737a374de.css?html"/>
    <link rel="stylesheet" href="./css/redacted.d97ee823c6c48e8c97362646cac137df.css?html"/>
    <link rel="stylesheet" href="./css/chalkboard.782bf36622bb88d7177823c27101be87.css?html"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="{% static 'css/style.css' %}" rel="stylesheet"/>

    <script src="/bundles/modernizr?v=wBEWDufH_8Md-Pbioxomt90vm6tJN2Pyy9u9zHtWsPo1"></script>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/bundles/bootstrap?v=QtxRrbVxHAK-b5ZowWqv6Wt7oUOJAggG80vl1X-EGBM1"></script>

    <script src="/bundles/timepicker?v=SNA17wI1rMl4CP8ayG1ydmEu0eLQfZiFCqPl0hXZpd01"></script>

    <script src="/bundles/sweet?v=ZMOC4FpxSbszBSzdHGvkc9O_scCReJoQ_PgxKeHWirk1"></script>

    <script src="https://use.fontawesome.com/877bbc2081.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

    <link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">

    <script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/export/bootstrap-table-export.min.js"></script>

    <script src="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.20.2/dist/extensions/defer-url/bootstrap-table-defer-url.min.js"></script>

</head>
<body style="overflow-x: hidden;">
    {% include 'nav.html' %}
    
    <div class="body-content">
        


<form action="{% url 'dashboards:captura_reasignamiento' lead.pk %}" method="post"><input name="__RequestVerificationToken" type="hidden" value="oYnbYvKMAQseqww4ADfCWv8GqrpzT2F6-yP4027iscSP_upHsR7WPXff478d61C5y5XZbwIo0edixcAzgtA7NLzuO21_KynyPkRiwg0-tkA1" />    <!--container principal-->
    {% csrf_token %}
    <div class="container container-fluid">
        <h4 style="margin:20px;">Venta - Captura Prospecto</h4>
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card-counter danger">
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <i class="material-icons">announcement</i>
                            <span class="count-numbers">
                                {{cantidad_morato}}
                            </span>
                            <a href="#" style="color: #ffffff;"><span class="count-name">Sala Morato</span></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card-counter bg-warning">
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <i class="material-icons">announcement</i>
                            <span class="count-numbers">
                                {{cantidad_127}}

                            </span>
                            <a href="#" style="color: #ffffff;"><span class="count-name">Sala 127</span></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12 bloque">
                                <h1>Informacion del Cliente</h1>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <h2>*Nombre</h2>
                                        <input class="p lttssp text-box single-line" id="NombreProspecto" maxlength="50" name="NombreProspecto" required="required" type="text" value="{{lead.prospecto.nombre}}" readonly/>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="NombreProspecto" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <h2>*Primer Apellido</h2>
                                        <input class="p lttssp text-box single-line" id="ApellidoPProspecto" maxlength="50" name="ApellidoPProspecto" required="required" type="text" value="{{lead.prospecto.apellido_paterno}}" readonly/>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="ApellidoPProspecto" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <h2>Segundo Apellido</h2>
                                        <input class="p lttssp text-box single-line" id="ApellidoMProspecto" maxlength="50" name="ApellidoMProspecto" type="text" value="{{lead.prospecto.apellido_materno}}" readonly/>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="ApellidoMProspecto" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <h2>*Celular</h2>
                                        <input class="p num text-box single-line" id="Celular" maxlength="13" name="Celular" placeholder="Telefono 1" required="True" type="number" value="{{lead.prospecto.celular}}" onkeydown="return event.keyCode !== 69 && event.keyCode !== 190" onchange="celular_verificar();" readonly/>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Celular" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <h2>Correo Electronico</h2>
                                        <input class="p text-box single-line" id="Correo" maxlength="100" name="Correo" placeholder="Email Principal" type="email" value="{{lead.prospecto.correo}}" readonly/>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Correo" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <h2>*Origen Lead</h2>
                                        <select class="p" id="OrigenLead" name="OrigenLead" required="required"><option disabled="disabled" value="">-- Origen Lead --</option>
<option value="LLAMADA CONMUTADOR" {% if lead.origen_lead == "LLAMADA CONMUTADOR" %}selected{% endif %}>LLAMADA CONMUTADOR</option>
<option value="LLAMADA CELULAR" {% if lead.origen_lead == "LLAMADA CELULAR" %}selected{% endif %}>LLAMADA CELULAR</option>
<option value="LLAMADA/CARROYA" {% if lead.origen_lead == "LLAMADA/CARROYA" %}selected{% endif %}>LLAMADA/CARROYA</option>
<option value="LLAMADA/TUCARRO" {% if lead.origen_lead == "LLAMADA/TUCARRO" %}selected{% endif %}>LLAMADA/TUCARRO</option>
<option value="LLAMADA/OLX" {% if lead.origen_lead == "LLAMADA/OLX" %}selected{% endif %}>LLAMADA/OLX</option>
<option value="CARROYA" {% if lead.origen_lead == "CARROYA" %}selected{% endif %}>CARROYA</option>
<option value="TUCARRO" {% if lead.origen_lead == "TUCARRO" %}selected{% endif %}>TUCARRO</option>
<option value="ESTRENAR CARRO"{% if lead.origen_lead == "ESTRENAR CARRO" %}selected{% endif %}>ESTRENAR CARRO</option>
<option value="OLX"{% if lead.origen_lead == "OLX" %}selected{% endif %}>OLX</option>
<option value="PÁGINA WEB" {% if lead.origen_lead == "PÁGINA WEB" %}selected{% endif %}>P&#193;GINA WEB</option>
<option value="CAMPAÑA PAGA FACEBOOK" {% if lead.origen_lead == "CAMPAÑA PAGA FACEBOOK" %}selected{% endif %}>CAMPA&#209;A PAGA FACEBOOK</option>
<option value="CAMPAÑA ORGÁNICA FACEBOOK" {% if lead.origen_lead == "CAMPAÑA ORGÁNICA FACEBOOK" %}selected{% endif %}>CAMPA&#209;A ORG&#193;NICA FACEBOOK</option>
<option value="INSTAGRAM" {% if lead.origen_lead == "INSTAGRAM" %}selected{% endif %}>INSTAGRAM</option>
<option value="CAMPAÑA FINANCIERA" {% if lead.origen_lead == "CAMPAÑA FINANCIERA" %}selected{% endif %}>CAMPA&#209;A FINANCIERA</option>
<option value="CONVENIO" {% if lead.origen_lead == "CONVENIO" %}selected{% endif %}>CONVENIO</option>
<option value="WHATSAPP MAZDA" {% if lead.origen_lead == "WHATSAPP MAZDA" %}selected{% endif %}>WHATSAPP MAZDA</option>
<option value="WHATSAPP DIRECTO USADOS" {% if lead.origen_lead == "WHATSAPP DIRECTO USADOS" %}selected{% endif %}>WHATSAPP DIRECTO USADOS</option>
<option value="WHATSAPP HYUNDAI" {% if lead.origen_lead == "WHATSAPP HYUNDAI" %}selected{% endif %}>WHATSAPP HYUNDAI</option>
<option value="Google Search" {% if lead.origen_lead == "Google Search" %}selected{% endif %}>Google Search</option>
<option value="WHATSAPP COMPRAS USADO" {% if lead.origen_lead == "WHATSAPP COMPRAS USADO" %}selected{% endif %}>WHATSAPP COMPRAS USADO</option>
<option value="TU USADO FINANDINA" {% if lead.origen_lead == "TU USADO FINANDINA" %}selected{% endif %}>TU USADO FINANDINA</option>
<option value="CORREO" {% if lead.origen_lead == "CORREO" %}selected{% endif %}>CORREO</option>
<option value="Retoma mazda" {% if lead.origen_lead == "Retoma mazda" %}selected{% endif %}>Retoma mazda</option>
<option value="Retoma hyundai" {% if lead.origen_lead == "Retoma hyundai" %}selected{% endif %}>Retoma hyundai</option>
<option value="Olx" {% if lead.origen_lead == "Olx" %}selected{% endif %}>Olx</option>
<option value="Retoma usados" {% if lead.origen_lead == "Retoma usados" %}selected{% endif %}>Retoma usados</option>
<option value="Compra Morato" {% if lead.origen_lead == "Compra Morato" %}selected{% endif %}>Compra Morato</option>
<option value="Usados 127" {% if lead.origen_lead == "Usados 127" %}selected{% endif %}>Usados 127</option>
<option value="Compra 127" {% if lead.origen_lead == "Compra 127" %}selected{% endif %}>Compra 127</option>
<option value="Renting Colombia" {% if lead.origen_lead == "Renting Colombia" %}selected{% endif %}>Renting Colombia</option>
<option value="Consignado" {% if lead.origen_lead == "Consignado" %}selected{% endif %}>Consignado</option>
<option value="Referido" {% if lead.origen_lead == "Referido" %}selected{% endif %}>Referido</option>
<option value="Rebold" {% if lead.origen_lead == "Rebold" %}selected{% endif %}>Rebold</option>
<option value="PÁGINA WEB FORMULARIO" {% if lead.origen_lead == "PÁGINA WEB FORMULARIO" %}selected{% endif %}>P&#193;GINA WEB FORMULARIO</option>
<option value="Finanzauto" {% if lead.origen_lead == "Finanzauto" %}selected{% endif %}>Finanzauto</option>
</select>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="OrigenLead" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <h2>Campaña</h2>
                                        <input class="p text-box single-line" id="Campania" maxlength="100" name="Campania" placeholder="" type="text" value="{{lead.campania}}" readonly/>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <h2>Tipo de Documento</h2>
                                        <select class="p" id="TipoDocumento" name="TipoDocumento" required="required"><option value="0">-- Tipo Documento --</option>
<option value="Cédula ciudadanía" {% if lead.tipo_documento == "Cédula ciudadanía" %}selected{% endif %}>C&#233;dula ciudadan&#237;a</option>
<option value="Cédula de extranjería" {% if lead.tipo_documento == "Cédula de extranjería" %}selected{% endif %}>C&#233;dula de extranjer&#237;a</option>
<option value="PASAPORTE" {% if lead.tipo_documento == "PASAPORTE" %}selected{% endif %}>PASAPORTE</option>
<option value="NIT" {% if lead.tipo_documento == "NIT" %}selected{% endif %}>NIT</option>
</select>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="TipoDocumento" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <h2>Documento</h2>
                                        <input class="p text-box single-line" id="Documento" maxlength="100" name="Documento" placeholder="" type="text" value="{{lead.documento}}" readonly/>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <h2>Politica de Datos: </h2>
                                        <div class="form-group form-check">
                                            <input class="form-check-input" id="PoliticaPrivacidad" name="PoliticaPrivacidad" type="checkbox" value="true" disabled/>
                                            <label class="form-check-label" for="PoliticaPrivacidad">¿El cliente acepto el tratamiento de datos personales y política de datos de madiautos?</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col bloque">
                                <h1>Asignación de Asesor</h1>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <h2>Recibido por: </h2>
<select class="p" id="Anfitrion" name="Anfitrion" required="required"><option selected disabled="disabled" value="0">-- Anfitrion --</option>
<option value="admin" {% if user.username == "admin" %}selected{% endif %}>admin</option>
<option value="Daniela Quijano" {% if user.username == "Daniela Quijano" %}selected{% endif %}>Daniela Quijano</option>
<option value="Sharon Diaz" {% if user.username == "Sharon Diaz" %}selected{% endif %}>Sharon Diaz</option>
<option value="Cristian Guzman" {% if user.username == "Cristian Guzman" %}selected{% endif %}>Cristian Guzman</option>
<option value="Brenda Milena Martinez Martinez" {% if user.username == "Brenda Milena Martinez Martinez" %}selected{% endif %}>Brenda Milena Martinez Martinez</option>
<option value="Mayerly Andrea Gutierrez Garcia" {% if user.username == "Mayerly Andrea Gutierrez Garcia" %}selected{% endif %}>Mayerly Andrea Gutierrez Garcia</option>
<option value="Jonathan Vargas" {% if user.username == "Jonathan Vargas" %}selected{% endif %}>Jonathan Vargas</option>
</select><span class="field-validation-valid text-danger" data-valmsg-for="Anfitrion" data-valmsg-replace="true"></span>                                    </div>
                                    <div class="form-group col-md-6">
                                        <h2>Sala: </h2>
                                        <select class="p" id="Sala" name="Sala" required onchange="filtrar_asesores();">
                                            <option disabled="disabled" selected>-- Sala --</option>
                                            <option value="127">127</option>
                                            <option value="Morato">Morato</option>
                                        </select>
                                        <span class="field-validation-valid text-danger" data-valmsg-for="Sala" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-10">
                                        <h2>Asesor</h2>
                                            <select name="Asesor" id="Asesor" required class="p">
                                                <option disabled="disabled">-- Asesor --</option>
                                            </select>
<span class="field-validation-valid text-danger" data-valmsg-for="Asesor" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                            </div>
                            <hr />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col bloque">
                                <div class="input-group">
                                    <h1>Informacion de Venta</h1>
                                    
                                </div>
                                <div class="form-row">

                                    <div class="form-group col-md-8">
                                        <h2>Marcas de Interes</h2>
                                        <input id="NumMarcas" name="NumMarcas" type="hidden" value="0" />
                                        <select class="col-12 selectpicker p" multiple title="Marcas de Interes" id="MarcasInteres" name="MarcasInteres">
                                            {% for marca in marcas %}
                                            <option value="{{marca.marca.upper}}">{{marca.marca.upper}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <div id="Marcas"></div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <label for="Linea" class="col-form-label">Comentario</label>
                                        <div class="control">
                                            <textarea class="form-control textarea has-fixed-size" placeholder="Escribe tu comentario..." id="Comentario" name="Comentario" readonly></textarea>
                                        </div>
                                    </div>
                                </div>
                                    <div class="form-group col-md-4">
                                        <h2>Interesado en: </h2>
                                        <div class="form-group form-check">
                                            <input id="TestDrive" name="TestDrive" type="checkbox" class="form-check-input" disabled>
                                            <label class="form-check-label" for="TestDrive">¿Este prospecto quiere agendar Test Drive?</label>
                                        </div>
                                    </div>
                                <div class="form-group" id="Coleccion">
                                </div>
                                <hr />

                                


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <button type="submit" value="Guardar" name="action" id="Guardar" class="btn btn-primary btn-lg btn-block">Guardar</button>
    </div>
</form>


    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"
      integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script>
    var temp = 0;

    function celular_verificar(){
        celular_verificar = document.getElementById("Celular").value;
        data = {}
        data.celular_verificar = celular_verificar
        console.log("hola")
        console.log(data)
        console.log(data.celular_verificar)

        $.ajax({
              type: "post", // "post" "get" "delete" "put"
              data: data, // PREFERIBLEMENTE JSON
              cache: false,
              headers: {
                "X-CSRFToken": Cookies.get("csrftoken")
              },
              success: function (response) {
                    console.log(response.alerta_celular)
                    console.log(response.ultimo_lead)
                    if (response.alerta_celular){
                    $("#navbarSupportedContent").append(`
                    <div id="modal_celular" class="sweet-alert show-input showSweetAlert visible" data-custom-class="" data-has-cancel-button="true" data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true" data-animation="pop" data-timer="null" style="display: block; margin-top: -213px;"><div class="sa-icon sa-error" style="display: none;">
                        <span class="sa-x-mark">
                          <span class="sa-line sa-left"></span>
                          <span class="sa-line sa-right"></span>
                        </span>
                      </div><div class="sa-icon sa-warning" style="display: none;">
                        <span class="sa-body"></span>
                        <span class="sa-dot"></span>
                      </div><div class="sa-icon sa-info" style="display: none;"></div><div class="sa-icon sa-success" style="display: none;">
                        <span class="sa-line sa-tip"></span>
                        <span class="sa-line sa-long"></span>
                  
                        <div class="sa-placeholder"></div>
                        <div class="sa-fix"></div>
                      </div><div class="sa-icon sa-custom" style="display: none;"></div><h2>Atencion!</h2>
                      <p style="display: block;">Un prospecto ya se ha dado de alta con el Celular ${celular_verificar}, capturado por el Anfitrión ${response.ultimo_lead.nombre_anfitrion}.<br>Tipo Operacion: Venta.<br> Fecha Captura: ${response.ultimo_lead.fecha_apertura}<br> Respuesta: ${response.ultimo_lead.respuesta}<br> Estado: ${response.ultimo_lead.estado}<br> Asesor/Comprador: ${response.ultimo_lead.nombre_asesor}.<br> ¿Deseas generar una nueva venta para el prospecto?</p>
                      <fieldset>
                        <input type="text" tabindex="3" placeholder="Comentario de Inicio">
                        <div class="sa-input-error"></div>
                      </fieldset><div class="sa-error-container">
                        <div class="icon">!</div>
                        <p>Not valid!</p>
                      </div><div class="sa-button-container">
                        <button class="cancel" tabindex="2" style="display: inline-block;" onclick='recargar();'>Cancel</button>
                        <div class="sa-confirm-button-container">
                          <button class="confirm" tabindex="1" style="display: inline-block; background-color: rgb(140, 212, 245); box-shadow: rgba(140, 212, 245, 0.8) 0px 0px 2px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px inset;" onclick='cerrar_modal();'>OK</button><div class="la-ball-fall">
                            <div></div>
                            <div></div>
                            <div></div>
                          </div>
                        </div>
                      </div></div>
                    `)
                }
                },
              })
    }

    function cerrar_modal(){
        console.log("cerrar modal")
        $("#modal_celular").removeAttr("style").hide();

    }

    function recargar(){
        location.reload()
    }

    function filtrar_asesores(){
        sala = document.getElementById("Sala").value;
        data = {}
        data.sala = sala
        console.log("hola")
        console.log(data)
        console.log(data.sala)

        $.ajax({
              type: "post", // "post" "get" "delete" "put"
              data: data, // PREFERIBLEMENTE JSON
              cache: false,
              headers: {
                "X-CSRFToken": Cookies.get("csrftoken")
              },
              success: function (response) {
                $("#Asesor").empty()
                $(response).each(function (index, asesor) {
                    console.log(asesor)
                    console.log(asesor.nombre)
                    $("#Asesor").append(`
                    <option value="${asesor.nombre}">${asesor.nombre} </option>
                    `)
                })
                },
              })
    }

    $(document).ready(function () {
        $('#MarcasInteres').selectpicker();
        $("#OrigenLead").val('0');
        $("#Sala").val('0');
        $("#Interes").val('0');

        $("#Asesor").change(function () {
            var cliente = $("#NombreProspecto").val();
            var asesor = $("#Asesor").val();

            if(asesor=="" || asesor==null){
                $("#calendario").hide();
                $("#calendario").attr("hidden");
            }
            else {
                var Cliente = cliente.replace(/ /g, "+")
                var Asesor = asesor.replace(/ /g, "+")

                var date = new Date();
                var año = date.getFullYear();
                var mes = date.getMonth()+1;
                var dia = date.getDate();
                var hora = date.getHours();
                var min = date.getMinutes();
                var sec = date.getSeconds();

                if(mes<10)
                {
                    if (dia < 10)
                    {
                        var f = año + "-0" + mes + "-0" + dia;
                    }
                    else {
                        var f = año + "-0" + mes + "-" + dia;
                    }
                }
                else {
                    if (dia < 10) {
                        var f = año + "-" + mes + "-0" + dia;
                    }
                    else {
                        var f = año + "-" + mes + "-" + dia;
                    }
                }

                if(hora<10){
                    hora = "0" + hora;
                }
                if(min<10){
                    min = "0" + min;
                }
                if(sec<10){
                    sec = "0" + sec;
                }
                var h = "T" + hora + ":" + min + ":" + sec;
                var fecha = f;
                var time = f + h;
                document.getElementById("calendario").href = "https://calendar.google.com/calendar/u/0/r/eventedit?text=Asignacion+de+asesor+a+cliente+" + Cliente + "&dates=" + fecha + "Z/" + h + "00Z&ctz=UTC";
                //document.getElementById("calendario").href = "https://outlook.live.com/calendar/0/deeplink/compose?startdt=" + time + "\&enddt=" + time + "\&subject=Asignacion%20de%20Asesor\&body=El%20cliente%20"+Cliente+"%20se%20le%20ha%20asignado%20al%20asesor%20"+Asesor+"\&allday=true";
                //https://outlook.live.com/calendar/0/deeplink/compose?startdt=2020-08-12T00:00:00&enddt=2020-08-13T12:00:00&subject=Hello%20World&body=Hello%20World
                $("#calendario").show();
                $("#calendario").removeAttr("hidden");
            }
        });

        $("#agregar").click(function () {
            var tam = $('#CantMarcasGestion').val()
            while ($("#Marca").length) {
                $("#Marca").remove();
            }
            for (var cont = 0; cont < tam; cont++) {
                var item = '<div class="form-group col-md-6" id="Marca"><input id="NuevaEmpresa_Marca' + cont + '" name="NuevaEmpresa.Marca' + cont + '" type="text" class="p" placeholder="Nombre de Marca" required></div>'
                $("#Marcas").append(item);
            }
            $("#NumMarca").val(tam);
        })

        $("#Celular").focusout(function (event) {
            var Celular = $("#Celular").val();
            var data = {
                "Telefono": Celular
            };
            var baseUrl = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
            if (Celular != "" && Celular != null)
            {
                var bandera = $.ajax({
                    type: "POST",
                    url: baseUrl + "/Leads/GetProspecto",
                    data: data,
                    cache: false,
                    success: function (response) {
                        if (response != "1" && response != 1) {
                            document.getElementById("Celular").value = null;

                            swal({
                                title: "Atencion!",
                                text: "Un prospecto ya se ha dado de alta con el Celular " + Celular + ", capturado por el Anfitrión " + response.anfitrion + ".\nTipo Operacion: " + response.tipo + ".\n Fecha Captura: " + response.fechaCaptura + "\n Respuesta: " + response.respuesta + "\n Estado: " + response.estado + "\n Asesor/Comprador: " + response.asesor +".\n ¿Deseas generar una nueva venta para el prospecto?",
                                type: "input",
                                showCancelButton: true,
                                closeOnConfirm: false,
                                inputPlaceholder: "Comentario de Inicio"
                            }, function (inputValue) {
                                if (inputValue === false) return false;
                                //if (inputValue === "") {
                                //    swal.showInputError("You need to write something!");
                                //    return false
                                //}

                                var data2 = {
                                    "Telefono": Celular,
                                    "Comentario": inputValue
                                };
                                $.ajax({
                                    type: "POST",
                                    url: baseUrl + "/Leads/NuevaVenta",
                                    data: data2,
                                    cache: false,
                                    success: function (response) {
                                        swal({
                                            title: "OK!",
                                            text: "Se ha generado una nueva venta con el comentario de inicio: " + inputValue,
                                            type: "success",
                                            showCancelButton: true,
                                            confirmButtonClass: "btn-success",
                                            confirmButtonText: "OK!",
                                            closeOnConfirm: false
                                        },
                                        function () {
                                            window.location.href = baseUrl + "/Leads/LeadAnfitrion/" + response;
                                        });
                                        //swal("Ok!", "Se ha generado una nueva venta con el comentario de inicio: " + inputValue, "success");
                                    },
                                    error: function (response) {
                                        swal("Oh no!", "Tuvimos un problema al verificar la información, por favor intente de nuevo.", "warning");
                                    }
                                });
                                //swal("Ok!", "You wrote: " + inputValue, "success");
                            });
                            //swal("Atencion!", "Un prospecto ya se ha dado de alta con el Celular "+Celular+", capturado por el Anfitrión "+response+", favor de verificar.", "warning");
                        }
                    },
                    error: function (response) {
                        swal("Oh no!", "Tuvimos un problema al verificar la información, por favor intente de nuevo.", "warning");
                    }
                });
            }
        });
    });

    function SelectChanged() {
        var temp = $("#MarcasInteres").val();
        $('#Marcas').empty();
        $.each(temp, function (ind, elem) {

            var item = '<div id="toolbar" id="Coleccion" name="Coleccion"><input hidden type="text" id="Marca'+ind+'" name="Marca'+ind+'" value="'+elem+'"><input id="NumLineaPrograma' + ind + '" name="NumLineaPrograma' + ind + '" value="0" hidden type="number" /><button type="button" id="add' + ind + '" class="btn btn-primary btn-sm" onclick="add(' + ind + ');"><i class="material-icons r">add</i> Modelo de Vehiculo</button></div><table id="table' + ind + '" data-toggle="table" data-detail-view="true" data-detail-formatter="detailFormatter"><thead><tr class="tr-class-1"><th colspan="3">Marca ' + elem + '</th></tr><tr class="tr-class-2"><th data-field="Modelo">Modelo</th><th data-field="Color">Color</th><th data-field="Comentario">Comentario</th></tr></thead><tbody></tbody></table><hr id="Division" />';
            $("#Marcas").append(item);

        });
        $("#NumMarcas").val(temp.length);
    }

    function add(cont) {
        var marca= $("#Marca" + cont).val();
        
        //var newInput = '<tr><td><select class="p" id="Marca_' + cont + 'Modelo' + temp + '" name="Marca.' + cont + 'Modelo' + temp + '"><option disabled selected>-- Modelo --</option>'+options+'</select></td><td><select id="Marca_' + cont + 'Color' + temp + '" name="Marca.' + cont + 'Color' + temp + '" class="p">'+colores+'</select></td><td><textarea style="width: 100%;" rows="2" id="Marca_' + cont + 'Comentario' + temp + '" name="Marca.' + cont + 'Comentario' + temp + '"></textarea></td></tr>';
        var string='<select class="p" id="Marca_' + cont + 'Modelo' + temp + '" name="Marca.' + cont + 'Modelo' + temp + '"><option disabled="disabled" value="0" selected>-- Modelo --</option></select>';
        var newInput = '<tr><td><select class="p" id="Marca_' + cont + 'Modelo' + temp + '" name="Modelo"><option disabled="disabled" value="0" selected>-- Modelo --</option></select></td><td><input type="text" class="p" id="Marca_' + cont + 'Color' + temp + '" name="Color"></td><td><textarea style="width: 100%;" rows="2" id="Marca_' + cont + 'Comentario' + temp + '" name="MarcaComentario"></textarea></td></tr>';
        $("#table" + cont + " tbody").append(newInput);
        $("#NumLineaPrograma" + cont).val(temp);
        marca = document.getElementById("MarcasInteres").value;

        marca_select = document.getElementById("MarcasInteres");
        boton_modelo = document.getElementById("add" + cont);
    
        const selectedOptions = [];
    
            for (const option of marca_select.options) {
                if (option.selected) {
                selectedOptions.push(option.value);
                }
            }

        data = {}
        data.marca = selectedOptions[cont]
        console.log("hola")
        console.log(selectedOptions)
        console.log(data)
        console.log(data.marca)

        $.ajax({
              type: "post", // "post" "get" "delete" "put"
              data: data, // PREFERIBLEMENTE JSON
              cache: false,
              headers: {
                "X-CSRFToken": Cookies.get("csrftoken")
              },
              success: function (response) {
                console.log($('#Marca_' + cont + 'Modelo' + temp))
                $('#Marca_' + cont + 'Modelo' + temp).empty()
                $(response).each(function (index, modelo) {
                    console.log(modelo)
                    console.log(modelo.nombre)
                    console.log('#Marca_' + cont + 'Modelo' + temp)
                    $('#Marca_' + cont + 'Modelo' + temp).append(`
                    <option value="${modelo.nombre}">${modelo.nombre} </option>
                    `)
                })
                temp++;
            },
            })
    };
</script>

        <hr />
        <footer>
            <p>&copy; 2023 - Capital Network</p>
        </footer>
    </div>

    
    
    <script src="/bundles/jqueryval?v=hEGG8cMxk9p0ncdRUOJ-CnKN7NezhnPnWIvn6REucZo1"></script>


</body>
</html>
